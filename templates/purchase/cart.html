{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'landing/cart.css' %}">
    
<main class="main-content">
    <div class="cart-container">
        <div class="cart-content">
            <ul class="cart-items">
                {% for cart_item in cart.items.all %}
                    <li class="cart-item">
                        {% if cart_item.workshop.image %}
                            <img src="{{ cart_item.workshop.image.url }}" alt="{{ cart_item.workshop.title }}">
                        {% else %}
                            <p>No Image Available</p>
                        {% endif %}
                        <div class="item-details">
                            <h3>{{ cart_item.workshop.title }}</h3>
                            <p>Price: â‚¬{{ cart_item.workshop.price }}</p>
                            <p>Date and Time: {{ cart_item.date_time }}</p>
                            <p>Quantity: {{ cart_item.quantity }}</p>

                            <!-- Form for removing item from cart -->
                            <form class="remove-item-form" action="{% url 'remove_cart_item' cart_item.id %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="item_id" value="{{ cart_item.id }}">
                                <button type="submit" class="remove-item-btn">Remove</button>
                            </form>
                        </div>
                    </li>
                {% empty %}
                    <li>Your cart is empty.</li>
                {% endfor %}
            </ul>
        <!-- Book Now Button -->
            <form action="{% url 'book_now' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="book-now-btn">Book Now</button>
            </form>
        
            <a href="{% url 'workshop_list' %}">Continue Shopping</a>
        </div>
    </div>

</main>
    

<script src="{% static 'workshop_static/js/scripts.js' %}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        // Submit form when Remove button is clicked
        $('.remove-item-btn').on('click', function(e) {
            e.preventDefault();
            var form = $(this).closest('form');
            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: form.serialize(),
                success: function(response) {
                    if (response.success) {
                        form.closest('.cart-item').remove(); // Remove the item from UI
                    } else {
                        console.error('Failed to remove item from cart');
                    }
                },
                error: function(response) {
                    console.error('Error removing item from cart');
                }
            });
        });
    });
</script>
{% endblock %}

